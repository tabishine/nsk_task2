@model List<task2.Models.HierarchicalItem>
<h2>Hierarchical Items</h2>

<ul id="itemList">
    @foreach (var rootItem in Model)
    {

        <li>

            <span class="item-name">@rootItem.NAME</span>
            <button class="toggle" data-id="@rootItem.ID">Переключиться</button>
            <button class="edit" data-id="@rootItem.ID">Редактировать</button>
            <button class="delete" data-id="@rootItem.ID">Удалить</button>
            <ul class="child-items hidden">
                @foreach (var childItem in Model)
                {
                    <li>
                        <span class="item-name">@childItem.NAME</span>
                        <button class="edit" data-id="@childItem.ID">Редактировать</button>
                        <button class="delete" data-id="@childItem.ID">Удалить</button>
                    </li>
                }
            </ul>
        </li>
    }
</ul>

<button id="addItemButton">Добавить</button>

<!-- Модальное окно для добавления/редактирования -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Добавить/Редактировать</h2>
        <form id="itemForm" method="post">
            <input type="hidden" id="itemId" name="ID" />
            <input type="text" id="itemName" name="NAME" placeholder="Item Name" required />
            <select id="parentItem" name="PARENTID">
                <option value="">None</option>
                @foreach (var item in Model)
                {
                    <option value="@item.ID">@item.NAME</option>
                }
            </select>
            <button type="submit" id="saveButton">Сохранить</button>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Показать/скрыть дочерние элементы при нажатии на кнопку "Toggle"
            $(".toggle").on("click", function () {
                $(this).siblings(".child-items").toggleClass("hidden");
            });

            // Показать модальное окно для добавления нового элемента
            $("#addItemButton").on("click", function () {
                $("#itemId").val("");
                $("#itemName").val("");
                $("#parentItem").val("");
                $("#myModal").show();
            });

            // Показать модальное окно для редактирования элемента
            $(".edit").on("click", function () {
                var itemId = $(this).data("id");
                var item = @Html.Raw(Json.Serialize(Model));
                if (item) {
                    $("#itemId").val(item.ID);
                    $("#itemName").val(item.NAME);
                    $("#parentItem").val(item.PARENTID);
                    $("#myModal").show();
                }
            });

            // Закрыть модальное окно при нажатии на крестик
            $(".close").on("click", function () {
                $("#myModal").hide();
            });

            // Отправить данные формы при нажатии на кнопку "Save"
            $("#itemForm").submit(function (e) {
                e.preventDefault();
                var formData = $(this).serializeArray();
                $.post("/Home/AddItem", formData, function () {
                    location.reload();
                });
            });

            // Обработка удаления элемента
            $(".delete").on("click", function () {
                var itemId = $(this).data("id");
                $.post("/Home/DeleteItem", { itemId: itemId }, function () {
                    location.reload();
                });
            });
        });
    </script>
}
